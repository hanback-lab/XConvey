# 펌웨어 설계 - 컨베이어 제어



펌웨어란 "특수한 목적을 달성하기위한 하드웨어 장치를 제어하기 위한 소프트웨어"로 짧게 정의 될 수 있습니다.
대부분의 경우 MCU(Micro Controller Unit) 에서 동작하게 됩니다.

IOT 플랫폼에 연계된 공정에 장착된 센서나 기타 장치가 부착된 장비는 작업물의 이동, 구성, 작업형태등을 파악하여 실시간으로 수집하여 전송하며, 이렇게 수집된 데이터를 분석함으로써 생산 공정의 효율성을 극대화하고 생산량을 최적화할 수 있습니다.   
IOT 데이터 기반의 공정 자동화를 통해 특정 조건 충족 시 기계의 자동 작동 또는 정지 설정이 가능해져 인적 오류를 줄일 수 있습니다. 장비 상태를 실시간으로 모니터링하여 고장을 사전에 예측하고 예방함으로써 장비 수명 연장 및 갑작스러운 고장으로 인한 생산 차질을 최소화합니다.
본 키트에서의 PICO W MCU에서는 펌웨어 구현에 쉽게 접근 할 수 있는 기능을 제공합니다.


펌웨어의 설계 과정에서는 구성된 장치의 기능 및 회로 구성을 분석하여 구체적으로 기능 구현 방법을 구상합니다. 
우선 각 장치의 기능과 그에 대응되는 컨트롤 인터페이스, 프로토콜등을 정리합니다. 취합된 기능을 명세를 통해,
각 부분의 컨트롤 인터페이스를 설계합니다. 예를 들어 컨베이어를 살펴보겠습니다. 컨베이어의 기능은 물체의 이송이며, 시작 스위치에 따라 일정한 속도로 물건을 이송하는 기능을 수행하는 것입니다. 벨트를 구동하는 곳은 모터 드라이브이며, PWM 신호로 제어됩니다. 즉 요약하면 스위치의 인풋에 따라 구동을 제어하는 PWM 신호를 송출하면 됩니다.

본 키트의 컨베이어모터는 PICO W의 GPIO2, GPIO3번에 연결되어 있습니다.
따라서 PICO의 GPIO2, GPIO3번을 사용해서 컨베이어 모터를 작동시킬 수 있습니다.

```python
from machine import Pin, PWM
import time

motor_a = PWM(Pin(2))
motor_b = PWM(Pin(3))

def init():
    motor_a.freq(1000)
    motor_b.freq(1000)
    motor_a.duty_u16(0)
    motor_b.duty_u16(0)

def stopMotor():
    motor_a.duty_u16(0)
    motor_b.duty_u16(0)

def goMotor(pwm_value):
    motor_a.duty_u16(pwm_value)
    motor_b.duty_u16(0)

def backMotor(pwm_value):
    motor_a.duty_u16(0)
    motor_b.duty_u16(pwm_value)  

def main():
    stopMotor()
    time.sleep(1)
    goMotor()
    time.sleep(1)
    stopMotor()
    time.sleep(1)
    backMotor()
    time.sleep(1)
    stopMotor()
```


