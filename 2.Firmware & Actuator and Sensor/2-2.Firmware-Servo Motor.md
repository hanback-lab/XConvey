# 펌웨어설계 - 서보모터 제어

본 키트의 재료 투입, 스탬핑, 금속탐지, 소팅 기능은 서보모터에 의해 구동됩니다. 서보모터는 UART 통신으로 제어됩니다.
Serial Port는 115200bps 의 속도로 연결됩니다.

각 서보모터 제품별로 제조사가 정의한 제어 프로토콜이 있습니다. 본 키트에 사용된 HTS-16L 서보모터의 패킷 구조는 다음과 같습니다.

Header ID number Data Length Command Parameter Checksum

0x55    0x55    ID  Length  Cmd Prm 1...    Prm N   Checksum

Checksum = ~(ID+ Length+Cmd+ Prm1+...PrmN)


```out
from machine import Pin, PWM
import time

uart1 = UART(1, baudrate=115200, tx=Pin(8), rx=Pin(9))
position_servo_in = 700

#Servor in Motor의 ID 는 0x21 입니다.

send_data = [STX,0x21,0x02,(position_servo_in>>8)&0xFF,position_servo_in&0xFF]


모터의 각도는 다음과 같습니다. 0~240 degree 까지 회전하며, 이는 최대 1000 위치에서의 각도 값입니다. 서보 모터 앵글과 포지션간의 계산은 240/1000 = 0.24 이며, 예를 들어 90degree 회전 시키려면 90/0.24 = 375 값을 넣으면 됩니다.
투입 서보모터의 각도는 기본을 700 이므로 각도는 0.24*700 = 168(degree) 가 됩니다.

모터를 168도 회전시키는 예제코드는 다음과 같습니다.

```python

def moveServoInToOrigin():
    pwm = bytes([02, BC) #700
    servo_data = bytes([0x55, 0x55, 0x01, 0x07, 0x01, pwm[1], pwm[0], 0x00, 0x00])
    crc_value = 0
    for byte in servo_data[2:]:
        crc_value += byte
        crc_value = ~crc_value & 0xFF
        servo_data = servo_data + bytes([crc_value])
        uart1.write(servo_data)

```



