# 펌웨어 설계
펌웨어(Firmware)는 하드웨어를 제어하기 위해 장치 내부에 내장된 소프트웨어입니다. 운영체제보다  하드웨어에 밀접하며, ROM이나 플래시 메모리에 저장되어 부팅 시 자동 실행되는 특징이 있습니다. 

주로 마이크로 컨트롤러와 같은 특수 목적을 가지고 동작하는 기기에 포함되며, 운영체제 없이 동작하는 경우가 많습니다. 여기서는 XHome의 Auto제어기를 통해 간단한 펌웨어 설계 방법에 대해 알아보도록 하겠습니다. 

## 마이크로파이썬 
마이크로파이썬(MicroPython)은 마이크로컨트롤러(MCU)와 같은 제한된 자원 환경에서도 실행할 수 있도록 설계된 경량화된 파이썬 인터프리터입니다. 표준 파이썬의 문법과 라이브러리를 최대한 유지하면서, 하드웨어 제어에 최적화된 기능들을 제공합니다. 

마이크로파이썬의 특징을 간략하게 정리하면 다음과 같습니다. 

| 특징 | 설명 | 
|:-------:|:------|
| 경량화 | 약 256KB의 ROM, 16KB의 RAM 만으로도 실행 가능 |
| 호환성 | 표준 파이썬과 매우 유사한 문법 |
| 실시간 실행 | 코드를 수정하고 바로 테스트할 수 있는 REPL 환경 |
| 하드웨어 제어 | GPIO, I2C, SPI, PWM, UART 등의 제어 라이브러리 제공 |
| 다양한 플랫폼 지원 | Raspberry Pi Pico, ESP32, STM32 등 다양한 MCU 보드에서 사용 가능 |

MicroPython의 세부 기능 및 각 플랫폼별 지원 여부는 공식 문서를 통해 확인할 수 있습니다.
XHome의 Auto 제어기는 Raspberry Pi Pico 기반으로 구성되어 있으며, 해당 보드는 RP2 플랫폼 문서를 참조하면 됩니다.

- [MicroPython API Documents](https://docs.micropython.org/en/latest/)
- [MicroPython RP2 Quick Reference](https://docs.micropython.org/en/latest/rp2/quickref.html)

## Auto 제어기 와 장치 연결 구성 
Auto 제어기와 XConvey 의 장치는 다양한 방식으로 연결되어 있습니다. 센서 및 액츄에이터의 종류에 따라 연결 방식이 다르며, 각 연결 방식에 따른 제어 방법도 상이합니다. 

### 액츄에이터 연결 구성 
XConvey 에서 제어가능한 액츄에이터를 정리하면 다음과 같습니다. 

- Indicator 
- Conveyor 
- Feeding Servo Motor 
- Processing Servo Motor 
- Sorting Servo Motor 

Indicator 는 Auto 제어기의 GPIO와 연결되어 있으며, Conveyor 를 제어하는 DC Motor도 GPIO와 연결되어 있습니다. Servo Motor는 총 3종이 있으며 이 모터들을 UART 를 통해 연결되어 있습니다. 

#### Indicator 
Indicator 는 GPIO 와 연결되어 있으며, 총 3개의 GPIO와 연결되어 있습니다. 각각 Red, Yellow, Green 과 연결되어 있습니다. 사용하는 GPIO의 정보는 다음과 같습니다. 

| GPIO | Function |
|:-------:|:------:|
| 19 | Red |
| 20 | Yellow |
| 21 | Green | 
 
 ---

 #### Conveyor  
 Conveyor 는 DC Motor를 통해 동작하며, 2개의 GPIO와 연결되어 있습니다. 2개의 GPIO중 1개의 GPIO에 신호에 따라서 동작되며 동시에 신호를 주게되면 동작하지 않습니다. 

| GPIO | Function |
|:-------:|:------:|
| 2 | Motor A |
| 3 | Motor B |
 
 ---

### 센서 연결 구성 
XConvey 에 장착되어 있는 센서는 9종입니다. 모두 GPIO 와 연결되어 있습니다. 

| GPIO | Function |
|:-------:|:------:|
| 4 | Encoder A |
| 5 | Encoder B |
| 6 | Inductive |
| 10 | Feeding Photo Sensor |
| 11 | Sorting Photo Sensor |
| 12 | Processing Photo Sensor |
| 13 | Basket Photo Sensor A |
| 14 | Basket Photo Sensor B |
| 17 | Start Switch |
| 26 | Stop Switch |

## Start Switch 모니터링 


```python

```

작성된 프로그램은 upy 명령을 통해 Auto 제어기에서 실행할 수 있습니다. 다음은 upy 명령을 사용하여 프로그램을 실행하는 예시입니다. 여기서 "COM PORT" 는 실행하는 운영체제에 따라 명칭이 다를 수 있습니다. 

- Windows : COM1, COM2 ...
- Linux : /dev/ttyACM0, /dev/ttyS0 ... 

연결된 PC 환경에 맞는 포트 이름을 정확하게 입력해야 정상적으로 통신이 가능합니다. 

```sh
> upy -s <COM PORT> run pir.py 
ex) upy -s COM15 run pir.py 

```

## Processing Photo Sensor 모니터링 


```python

```

```sh 
> upy -s <COM PORT> run dust.py 
ex) upy -s COM15 run dust.py 

```

## Indicator 제어 


```python

```

```sh
> upy -s <COM PORT> run fan.py 
ex) upy -s COM15 run fan.py 
```

## Sorting Servo Motor 제어 

```python
```

```sh
```